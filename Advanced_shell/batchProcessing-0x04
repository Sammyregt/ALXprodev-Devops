#!/bin/bash

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
API_URL="https://pokeapi.co/api/v2/pokemon"
DATA_DIR="pokemon_data"

mkdir -p $DATA_DIR

PIDS=()   # store process IDs

echo "Fetching PokÃ©mon data in parallel..."

for pokemon in "${POKEMONS[@]}"; do
    (
        echo "Fetching $pokemon..."
        curl -s --fail "$API_URL/$pokemon" -o "$DATA_DIR/$pokemon.json"

        if [ $? -ne 0 ]; then
            echo "Error fetching $pokemon" >> errors.txt
            exit 1
        fi
    ) &

    PIDS+=($!)   # save PID
done

# Wait and check processes
for pid in "${PIDS[@]}"; do
    wait $pid
    STATUS=$?

    if [ $STATUS -ne 0 ]; then
        echo "Process $pid failed. Killing it..."
        kill $pid 2>/dev/null
    fi
done

echo "All background processes completed."

