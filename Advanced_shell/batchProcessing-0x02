#!/bin/bash

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
DATA_DIR="pokemon_data"
ERROR_LOG="errors.txt"
API_URL="https://pokeapi.co/api/v2/pokemon"

# Create folder if not exists
mkdir -p $DATA_DIR
> $ERROR_LOG   # clear previous errors

# Loop through Pokémon list
for pokemon in "${POKEMONS[@]}"; do
    echo "Fetching data for $pokemon..."

    ATTEMPT=1
    SUCCESS=0

    # Retry up to 3 times
    while [ $ATTEMPT -le 3 ]; do
        echo "Attempt $ATTEMPT for $pokemon..."

        curl -s --fail "$API_URL/$pokemon" -o "$DATA_DIR/$pokemon.json"

        # Check exit status
        if [ $? -eq 0 ]; then
            echo "Saved data to $DATA_DIR/$pokemon.json ✅"
            SUCCESS=1
            break
        else
            echo "Error fetching $pokemon (Attempt $ATTEMPT)" >> $ERROR_LOG
            ((ATTEMPT++))
            sleep 2   # delay before retry
        fi
    done

    # If still failed after 3 tries
    if [ $SUCCESS -eq 0 ]; then
        echo "Failed to fetch $pokemon after 3 attempts ❌" >> $ERROR_LOG
        echo "Skipping $pokemon..."
    fi

    # Rate limit delay
    sleep 1
done

echo "Done fetching Pokémon data."

